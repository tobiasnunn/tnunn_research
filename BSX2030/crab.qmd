---
date: "`r format(Sys.time(), '%B %d, %Y')`"
title: "Oxygen uptake rates in a typical gill-breather"
format: docx
editor: visual
---

## Practical 1: Assessment

## BSX-2030 Integrated Zoology

## Student number: 500690571

![© Hans Hillewaert [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/)](1024px-Carcinus_maenas.jpg){fig-align="center"}

{{< pagebreak >}}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyr)
library(flextable)
library(equatags)
library(officer)
```

## Task 1

Task 1: Present the data in 4 tables i.e. Tables 6, 7, 8 and 9 from the practical handout. Each table needs a caption. Table titles go above the table

```{r rawdata, echo=FALSE}

crab_data <- data.frame(crab_name = c("A1", "A2", "A1", "A2", "A1", "A2"),
                        treatment = c("Submerged", "Submerged", "Aerial Exposure", "Aerial Exposure", "Resubmerged","Resubmerged"),
                        po_diff = c(13.3, 14.3, -0.9, 1, 15.2, 7.8),
                        time_diff = c(19, 19, 61, 61, 15, 15),
                        mass = c(0.02691, 0.02773,0.02691, 0.02773,0.02691, 0.02773),
                        volume = c(795,800,795,800,795,800)) 
# then add calculated columns
crab_data$solubility <-  crab_data$po_diff * 0.0000387
crab_data$solubility_by_volume <- crab_data$solubility * crab_data$volume
crab_data$solubility_by_time <- crab_data$solubility_by_volume * (60 / crab_data$time_diff)
crab_data$oxygen_by_mass <- crab_data$solubility_by_time / crab_data$mass
```

### Table 6 - calculation of Oxygen uptake for crabs in two aqueous conditions

```{r table6, echo=FALSE}

# bring in data
table6_data <- filter(crab_data, !treatment == "Aerial Exposure") %>%
  mutate(across(-c(crab_name, treatment, solubility), \(x) round(x, 2))) %>%
  select(-c(mass, oxygen_by_mass, volume))
table6 <- flextable(table6_data )

#headers and content
table6 <- set_header_labels(table6,
                            crab_name = "Crab\nName",
                            treatment = "Treatment",
                            time_diff = "Time\nbetween\nreadings\n(min)") %>%
  mk_par(
    # this is column A
    part = "header", j = "po_diff",
    value = as_paragraph("Difference\nin pO", as_sub("2"), "\n", "(mmHg)")
  ) %>% 
  mk_par(
    # this is column C
    part = "header", j = "solubility",
    value = as_paragraph("Difference\nin pO", as_sub("2"), "\n", "in water (mmHg)") 
  ) %>% 
  mk_par(
    # this is column D
    part = "header", j = "solubility_by_volume",
    value = as_paragraph("Difference\nin pO", as_sub("2"), "\naccounting\nfor volume\n(ml)") 
  ) %>% 
  mk_par(
    # this is column E
    part = "header", j = "solubility_by_time",
    value = as_paragraph("Oxygen Uptake\n(ml", as_sup("-1"), " O", as_sub("2"), " h", as_sup("-1"), ")"))
table6 <- theme_vanilla(table6)
table6 <- add_footer_lines(table6, "Data collected on 2025-01-30 at Deiniol Road, Brambell Building, 1st Floor Lab B1")
table6 <- color(table6, part = "footer", color = "#666666")
# table6 <- set_caption(table6, caption = paste0("New York Air Quality Measurements"))
table6 <- add_header_row(table6,
  colwidths = c(2, 1, 1, 1, 1, 1),
  values = c("", "A", "B", "C", "D","E")
)

#footnotes
table6 <- set_table_properties(table6, width = 1, layout = "autofit") %>%
footnote(i = 2, j = 5, 
           part = "header",
           ref_symbols = "*", 
         value = as_paragraph("value from column A ", as_equation("\\times"), " solubility coefficient (3.87", as_equation("\\times"), " 10", as_sup("-5"), ")")) %>%
footnote(i = 2, j = 6, 
           part = "header",
           ref_symbols = "†", 
         value = as_paragraph("value from column C ", as_equation("\\times"), " vol of water (ml)")) %>%
footnote(i = 2, j = 7, 
           part = "header",
           ref_symbols = "‡", 
         value = as_paragraph("value from column D " , as_equation("\\times"), " (", as_equation(x = "{60 \\over B}"), ") (ml", as_sup("-1"), " O", as_sub("2"), " h", as_sup("-1"), ")"))

table6 <- table6 %>% 
  set_formatter(solubility = function(x) {
    formatC(x, format = "e", digits = 2)
  })

table6 <- fontsize(table6, size = 10, part = "header")
# poss options for format 
# e = "e-5" / f = "0".00" / E = "E-5" / g = normal / G = normal but no trailing 0s # / fg apparantly does same as G / s is weird 
table6
```

### Table 7 - Oxygen uptake rate accounting for weight and converting to mmol for shore crabs in two aqueous conditions

```{r table7, echo=FALSE}
table7_data <- filter(crab_data, !treatment == "Aerial Exposure") %>% 
  mutate(column_c = oxygen_by_mass / 22.414) %>%
  select(crab_name, treatment, solubility_by_time, oxygen_by_mass, column_c) %>%
  mutate(across(-c(crab_name, treatment), \(x) round(x, 2)))
# headers
table7 <- flextable(table7_data)
table7 <- set_header_labels(table7,
                            crab_name = "Crab\nName",
                            treatment = "Treatment") %>% 
  mk_par(
    # column A
    part = "header", j = "solubility_by_time",
    value = as_paragraph("Oxygen uptake rate\n(ml", as_sup("-1"), " O", as_sub("2"), " h", as_sup("-1"), ")")
  ) %>%
  mk_par(
    # Column B
    part = "header", j = "oxygen_by_mass",
    value = as_paragraph("Oxygen uptake\nrate per unit mass\n(ml O", as_sub("2"), " kg",  as_sup("-1"), " h", as_sup("-1"), ")")
  ) %>%
  mk_par(
    # column C
    part = "header", j = "column_c",
    value = as_paragraph("Standardised\nOxygen uptake rate\n(mmol O", as_sub("2"), " kg",  as_sup("-1"), " h", as_sup("-1"), ")")
  )

# theme stuff
table7 <- theme_vanilla(table7)
table7 <- add_footer_lines(table7, "Data collected on 2025-01-30 at Deiniol Road, Brambell Building, 1st Floor Lab B1")
table7 <- color(table7, part = "footer", color = "#666666")
table7 <- set_caption(table7, caption = "God knows")
table7 <- add_header_row(table7,
  colwidths = c(2, 1, 1, 1),
  values = c("", "A", "B", "C")
)
# footnotes and extra
table7 <- set_table_properties(table7, width = 1, layout = "autofit") %>%
footnote(i = 2, j = 4, 
           part = "header",
           ref_symbols = "*", value = as_paragraph("value from column A divided by body mass in kg")) %>%
footnote(i = 2, j = 5, 
           part = "header",
           ref_symbols = "†", value = as_paragraph("value from column B divided by 22.414 (the conversion ratio between moles and litres). Conversion to mmol is in aid of comparing these values with those calculated in air (Table 8)")) 
table7 <- fontsize(table7, size = 10, part = "header")
table7

```

### Table 8 - Calculating Oxygen uptake for shore crabs exposed to air

```{r table8, echo=FALSE}
# can we avoid mutating the columns in thedata frame? this should bea display feature
# mutate(across(-c(crab_name, treatment), ~ signif(.x, digits = 2)))
# data stuff
aerial_data <- filter(crab_data, treatment == "Aerial Exposure") %>% 
  mutate(rt = 17969) %>%
  mutate(vol_of_oxy = (po_diff/rt) * (volume/1000)) %>%
  mutate(div_weight = vol_of_oxy / mass) %>%
  mutate(per_hour = div_weight * (60/61)) %>%
  select(crab_name, treatment, rt, po_diff, vol_of_oxy, div_weight, per_hour)

table8 <- flextable(aerial_data )
# headers
table8 <- set_header_labels(table8,
                            crab_name = "Crab\nName",
                            treatment = "Treatment") %>% 
  mk_par(
    # this is column A
    part = "header", j = "rt",
    value = as_paragraph("Universal gas\nconstant", as_equation("\\times"), "assumed\ntemperature\n(", as_equation("RT"), ")")
  ) %>%
  mk_par(
    # this is column B
    part = "header", j = "po_diff",
    value = as_paragraph("Difference\nin pO", as_sub("2"), "\n", "(mmHg)")
  ) %>%
  mk_par(
    # this is column C
    part = "header", j = "vol_of_oxy",
    value = as_paragraph("Difference\nin pO", as_sub("2"), "\n(mmol O", as_sub("2"),")")
  ) %>%
  mk_par(
    # this is D
    part = "header", j = "div_weight",
    value = as_paragraph("Difference\nper unit\nmass\n(mmol O", as_sub("2"), " kg",  as_sup("-1"), ")")
  ) %>%
  mk_par(
    # this is column E
    part = "header", j = "per_hour",
    value = as_paragraph("Oxygen uptake rate\n(mmol O", as_sub("2"), " kg",  as_sup("-1"), " h", as_sup("-1"), ")")
  )
table8 <- theme_vanilla(table8)
table8 <- add_footer_lines(table8, "Data collected on 2025-01-30 at Deiniol Road, Brambell Building, 1st Floor Lab B1")
table8 <- color(table8, part = "footer", color = "#666666")
table8 <- set_caption(table8, caption = "Crabs in the air")
table8 <- add_header_row(table8,
  colwidths = c(2, 1, 1, 1, 1, 1),
  values = c("", "A", "B", "C", "D", "E")
)

# footers and extra
table8 <- set_table_properties(table8, width = 1, layout = "autofit") %>%
footnote(i = 2, j = 3, 
           part = "header",
           ref_symbols = "*", 
         value = as_paragraph("The universal gas constant is 62.36, the experiment assumes a temperature of 15\u00b0C (which is 288.15\u00b0K)")) %>%
footnote(i = 1, j = 4, 
           part = "body",
           ref_symbols = "†", 
         value = as_paragraph("The container of crab A1 was found to have increased in partial pressure of Oxygen between readings, which would theoretically mean the crab lost oxygen, it is more likely this is an anomaly.")) %>%
footnote(i = 2, j = 5,
           part = "header",
           ref_symbols = "‡",
         value = as_paragraph(as_equation("{B \\over A} \\times"), " volume of air in litres ", "(mmol O", as_sub("2"),"). This reflects the equation for the ideal gas law, rearranged to find", as_equation("n"), " (to find the quantity of moles of oxygen), ", as_equation("{P \\over RT} \\times V = n"))) %>%
footnote(i = 2, j = 6,
           part = "header",
           ref_symbols = "§",
         value = as_paragraph("The oxygen difference in millimoles divided by the mass, in kg, for each crab (0.795 for A1 and 0.800 for A2). It should be noted that this step is not in the handout, but I felt it pertinent to include as the values of Oxygen uptake rate for the aqueous samples are in (mmol O", as_sub("2"), " kg",  as_sup("-1"), " h", as_sup("-1"), ")")) %>%
footnote(i = 2, j = 7,
           part = "header",
           ref_symbols = "¶",
         value = as_paragraph("The value in column C ", as_equation("\\times {60 \\over time interval}"), "(mmol O", as_sub("2"), " kg",  as_sup("-1"), " h", as_sup("-1"), "). Time interval recorded for both as 61 minutes"))


table8 <- table8 %>% style(
    j = c("po_diff", "vol_of_oxy", "div_weight", "per_hour"),
    i = ~ po_diff < 0 | vol_of_oxy < 0 | div_weight < 0 | per_hour < 0,
    pr_t = fp_text(color = "red"))

table8 <- set_formatter(
  x = table8,
  vol_of_oxy = function(x) {
    formatC(x, format = "e", digits = 2)
  },
  per_hour = function(x) {
    formatC(x, format = "e", digits = 2)
  },
  div_weight = function(x) {
    formatC(x, format = "e", digits = 2)
  }
)

table8 <- fontsize(table8, size = 9, part = "header")

table8

```

### Table 9 - Rates of oxygen uptake expressed as mmol O~2~ kg^-1^ h^-1^ in crabs submerged in seawater, exposed to roughly one hour aerial exposure and then resubmerged

```{r table9, echo=FALSE}
table9 <- crab_data %>% select(
  "crab_name", "treatment"
) 

# data
table9 <- table9 %>% left_join(table7_data, by = join_by(crab_name, treatment))

table9 <- left_join(table9, aerial_data, by = c("crab_name", "treatment")) %>%
  select(crab_name, treatment, column_c, per_hour)
table9$piv_value <- coalesce(table9$column_c, table9$per_hour)
table9 <- table9 %>% select(crab_name, treatment, piv_value)

pivot9 <- pivot_wider(data = table9, names_from = treatment, values_from = piv_value)

# plot
flex9 <- flextable(pivot9)
# headers
flex9 <- set_header_labels(flex9,
                            crab_name = "Crab\nName") 

# theming and styling
flex9 <- theme_vanilla(flex9)
flex9 <- add_footer_lines(flex9, "Data collected on 2025-01-30 at Deiniol Road, Brambell Building, 1st Floor Lab B1")
flex9 <- color(flex9, part = "footer", color = "#666666")
flex9 <- set_caption(flex9, caption = "Crabs in the air")


# extra things
flex9 <- set_formatter(
  x = flex9,
  'Aerial Exposure' = function(x) {
    formatC(x, format = "e", digits = 2)
  }) %>%
  add_header_row(
  colwidths = c(1,3),
  values = c("", "1")) %>%
  mk_par(
    part = "header", i = 1, j = 2,
    value = as_paragraph("Change in Oxygen uptake rate\n(\u394 mmol O", as_sub("2"), " kg",  as_sup("-1"), " h", as_sup("-1"), ")"))

flex9 <- align(flex9, i = 1, j = 2, align = "center", part = "header") %>%
  bg(j = c("crab_name"), bg = "grey90", part = "body") %>%
  bg(j = c("crab_name"), bg = "grey90", part = "header")

  #output
  flex9
```

## Task 2

### Table 10 - rates of Oxygen uptake (mmol 02 kg^-1 h^-1) with percentage changes compared to innitial "submerged" reading.
```{r table10, echo=FALSE}

pivot9$sub_vs_air <- (pivot9$`Aerial Exposure` - pivot9$Submerged) / pivot9$Submerged

pivot9$sub_vs_resub <- (pivot9$Resubmerged - pivot9$Submerged) / pivot9$Submerged

table10 <- flextable(pivot9, cwidth = 1, col_keys = c("crab_name", "Submerged", "Aerial Exposure", "change1", "Resubmerged", "change2")) %>%
  compose(
    j = "change1",
    i = which(pivot9$sub_vs_air < 0),
    value = as_paragraph(
      fmt_pct(sub_vs_air),
      " ",
      as_chunk("\u25BC", props = fp_text(color = "deeppink3"))
    )
  ) %>%
  compose(
    j = "change1",
    i = which(pivot9$sub_vs_air >= 0),
    value = as_paragraph(
      paste0("+", fmt_pct(sub_vs_air)),
      " ",
      as_chunk("\u25B2", props = fp_text(color = "darkgreen"))
    )
  ) %>%
  compose(
    j = "change2",
    i = which(pivot9$sub_vs_resub < 0),
    value = as_paragraph(
      fmt_pct(sub_vs_resub),
      " ",
      as_chunk("\u25BC", props = fp_text(color = "deeppink3"))
    )
  ) %>%
  compose(
    j = "change2",
    i = which(pivot9$sub_vs_resub >= 0),
    value = as_paragraph(
      paste0("+", fmt_pct(sub_vs_resub)),
      " ",
      as_chunk("\u25B2", props = fp_text(color = "darkgreen"))
    )
  ) %>%
  set_header_labels(
    crab_name = "Crab Name",
    `Aerial Exposure` = "Oxygen Uptake",
    change1 = "% change",
    Resubmerged = "Oxygen Uptake",
    change2 = "% change",
    Submerged = "Oxygen Uptake") %>%
  add_header_row(
    colwidths = c(1, 1, 2, 2),
    values = c("","Submerged","Aerial Exposure", "Resubmerged")
  ) %>%
  align(i = NULL, j = NULL, align = "right", part = "all") %>%
  align(i = NULL, j = 1, align = "center", part = "all") %>%
  bg(j = c("Submerged", "Resubmerged", "change2"), bg = "grey90", part = "all") %>%
  set_formatter(
  'Aerial Exposure' = function(x) {
    formatC(x, format = "e", digits = 2)
  }) %>%
  set_table_properties(layout = "autofit") %>%
  add_footer_lines("1") %>%
  mk_par(
    part = "footer", i = 1, j = 1,
    value = as_paragraph("Data collected on 2025-01-30 at Deiniol Road, Brambell Building, 1st Floor Lab B1. Change in Oxygen uptake rate is shown as \u394 mmol O", as_sub("2"), " kg",  as_sup("-1"), " h", as_sup("-1"))
  )

#,  as_sup("-1"), " h", as_sup("-1"), "
table10
```

Upon initial submersion of the crabs in seawater for 19 minutes, crab A1 experienced an Oxygen uptake of 2.14 mmol 02 kg^-1 h^-1 and crab A2 experienced an Oxygen uptake of 2.25 mmol 02 kg^-1 h^-1, i take these as baselines to compare the other readings with. A2 was heavier, with a weight of 0.0277 kg compared with crab A1's weight of 0.0269 kg, it should also be noted the volume of the tank for A1 was smaller by 5 ml at 795ml compared with 800ml for A2. Upon aerial exposure, crab A1 was found to have an Oxygen uptake rate of -1.46e-03 (mmol 02 kg^-1 h^-1), this is because an increase of PO2 was measured in the tank for A1, the PO2 for the tank of A2 was found to decrease, leading to an oxygen uptake rate being measured as 1.58e-03 (mmol 02 kg^-1 h^-1), both recordings were calculated over 61 minutes, as shown in Table 8. As shown in Table 10, these values are 100.1% and 99.9% decreases respectively. Compared with initial submersion, crab A1 was found to have in increased rate at 3.10 mmol 02 kg^-1 h^-1, a 45% increase, however, A2 was found to have a rate of 1.55 mmol 02 kg^-1 h^-1, a 31% decrease.

## Task 3

### Discussion
The initial higher reading for A2 can be explained by its bigger size... 
The negative value is my interpretation assuming the container was air tight, the oxygen came from the crab, it however could be an erroneous reading (give specific numbers)... 
crabs breathe much worse in air, only able to get one hundredth the amount of oxygen ... if my readings can be believed (do the math again)...
one crab breathed better, the other worse, perhaps an error in machinery, loose seal means the O2 increased in air and water got more aerated for submersion. or maybe the crabs just reacted differently by chance, with only these samples who knows (have a look at literature to see which is more likely, is better or worse breathing after air more common?)...
possible stress...
gender not taken...
i recommend pooling the class data so statistical analysis can be done on it... (rule out errors, find significance, that sort of stuff)
i created a 10th table on my own time using R to calculate the percentage change with the values as I hope this is a transparrent way of displaying the information. (not exactly this, but mention 10 and the use of R)...